<h1 class="text-xl font-semibold mb-4">Beitrag #<%= @post.id %></h1>

<div class="rounded-md border bg-white p-5 shadow-sm">
  <p class="mb-2"><strong>Text:</strong> <%= @post.content_text %></p>
  <% if @post.content_warning.present? %>
    <p><strong>CW:</strong> <%= @post.content_warning %></p>
  <% end %>
</div>

<h2 class="text-lg font-medium mt-6 mb-2">Auslieferungen</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <% @deliveries.each do |d| %>
    <div class="rounded-md border bg-white p-5 shadow-sm">
      <div class="text-sm font-medium mb-1"><%= d.provider_account.provider %></div>
      <div class="text-sm">Status: <%= d.status %></div>
      <% if d.provider_post_id.present? %>
        <div class="text-xs text-gray-600 break-all mt-1">ID: <%= d.provider_post_id %></div>
      <% end %>
      <% if d.error_message.present? %>
        <div class="text-xs text-red-700 mt-2">Error: <%= d.error_message %></div>
      <% end %>
    </div>
  <% end %>
</div>

<p class="mt-6"><%= link_to "New Post", new_post_path, class: "text-blue-600 hover:underline" %></p>

<% if (pa = @deliveries.find { |d| d.provider_account.provider == 'nostr' }&.provider_account) %>
  <h2 class="text-lg font-medium mt-6 mb-2">Nostr</h2>
  <div class="rounded-md border bg-white p-5 shadow-sm">
    <div class="flex flex-wrap gap-3">
      <button type="button" onclick="window.NostrConnect.connect()" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 hover:bg-gray-50">
        Mit Nostr Connect
      </button>
      <button type="button" onclick="window.NostrConnect.signAndPublish(<%= @post.id %>, <%= pa.id %>)" class="inline-flex items-center rounded-md bg-blue-600 text-white px-3 py-2 hover:bg-blue-700">
        Signieren & Publizieren (NIPâ€‘07)
      </button>
      <button type="button" onclick="window.NostrPrepare.prepare(<%= @post.id %>, <%= pa.id %>)" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 hover:bg-gray-50">
        Event als JSON herunterladen
      </button>
    </div>
  </div>
<% end %>


